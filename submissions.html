<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VRCDynamicPlayerTags - Submissions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- RESET & BASE -->
  <style>
    html { line-height: 1.15; }
    body { margin: 0; }
    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    a { text-decoration: none; color: inherit; }
    body { font-family: Inter, sans-serif; font-size: 1rem; line-height: 1.6; background: #f5f5f5; color: #111; }
    h1,h2,h3,h4,h5,h6 { margin: 0; }
    button { cursor: pointer; }
  </style>

  <link rel="stylesheet" href="./style.css" />
</head>
<body>

<header style="display:flex; justify-content:space-between; align-items:center; padding:1rem;">
  <h1>Submit a New Preset</h1>
  <button id="backBtn" class="btn">Back</button>
</header>

<main style="max-width:700px; margin:2rem auto; background:#fff; padding:2rem; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">

  <div style="margin-bottom:1rem;">
    <label>Target System</label><br>
    <input type="text" id="targetSystem" style="width:100%; padding:0.5rem;" />
  </div>

  <div style="margin-bottom:1rem;">
    <label>Description</label><br>
    <input type="text" id="description" style="width:100%; padding:0.5rem;" />
  </div>

  <div style="margin-bottom:1rem;">
    <label>Known TMPs (comma-separated)</label><br>
    <input type="text" id="knownTMPs" style="width:100%; padding:0.5rem;" />
    <small>List TMP IDs separated by commas.</small>
  </div>

  <div style="margin-bottom:1rem;">
    <label>Known Triggers (comma-separated)</label><br>
    <input type="text" id="knownTriggers" style="width:100%; padding:0.5rem;" />
    <small>List Trigger IDs separated by commas.</small>
  </div>

  <button id="submitBtn" style="padding:0.75rem 1.5rem; font-size:1rem;">Submit</button>

  <section style="margin-top:2rem;">
    <pre id="debugConsole" style="background:#111;color:#0f0;padding:1rem;overflow:auto;height:150px;"></pre>
  </section>
</main>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const targetSystem = document.getElementById("targetSystem");
  const description = document.getElementById("description");
  const knownTMPs = document.getElementById("knownTMPs");
  const knownTriggers = document.getElementById("knownTriggers");
  const submitBtn = document.getElementById("submitBtn");
  const debugConsole = document.getElementById("debugConsole");
  const backBtn = document.getElementById("backBtn");

  function log(msg) {
    debugConsole.textContent += msg + "\n";
    debugConsole.scrollTop = debugConsole.scrollHeight;
  }

  submitBtn.addEventListener("click", async () => {
    const payload = {
      targetSystem: targetSystem.value,
      description: description.value,
      knownTMPs: knownTMPs.value.split(",").map(s => s.trim()).filter(Boolean),
      knownTriggers: knownTriggers.value.split(",").map(s => s.trim()).filter(Boolean)
    };

    log(`→ Submitting preset ${payload.targetSystem}...`);

    try {
      const res = await fetch("/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (res.ok && data.success) {
        log(`✅ Submission successful: ${data.code}`);
        alert(`Preset submitted with code: ${data.code}`);
        window.history.back();
      } else {
        log(`❌ Submission failed: ${JSON.stringify(data)}`);
        alert("Submission failed. Check debug console.");
      }
    } catch (err) {
      log(`❌ Submission failed: ${err}`);
      alert("Submission failed. Check debug console.");
    }
  });

  backBtn.addEventListener("click", () => window.history.back());
});
</script>

</body>
</html>
