<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VRCDynamicPlayerTags Submissions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- RESET & BASE -->
  <style>
    html { line-height: 1.15; }
    body { margin: 0; font-family: Inter, sans-serif; line-height: 1.6; background:#f5f5f5; color:#111; }
    * { box-sizing: border-box; }
    input, textarea, button { font-family: inherit; font-size: 1rem; }
    button { cursor:pointer; }
  </style>
</head>
<body>

  <header style="padding:1rem; display:flex; justify-content:space-between; align-items:center; background:#222; color:#fff;">
    <h1>Submit New Preset</h1>
    <button id="goBackBtn" style="padding:0.5rem 1rem;">Back</button>
  </header>

  <main style="max-width:600px; margin:2rem auto; background:#fff; padding:2rem; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);">
    <div style="margin-bottom:1rem;">
      <label>Target System:</label><br>
      <input type="text" id="targetSystem" style="width:100%;padding:0.5rem;" />
    </div>

    <div style="margin-bottom:1rem;">
      <label>Description:</label><br>
      <textarea id="description" rows="3" style="width:100%;padding:0.5rem;"></textarea>
    </div>

    <div style="margin-bottom:1rem;">
      <label>Known TMPs (comma separated):</label><br>
      <input type="text" id="knownTMPs" style="width:100%;padding:0.5rem;" />
    </div>

    <div style="margin-bottom:1rem;">
      <label>Known Triggers (comma separated):</label><br>
      <input type="text" id="knownTriggers" style="width:100%;padding:0.5rem;" />
    </div>

    <button id="submitBtn" style="padding:0.7rem 1.5rem;">Submit Preset</button>

    <section style="margin-top:1.5rem;">
      <pre id="debugConsole" style="background:#111;color:#0f0;padding:1rem;overflow:auto;height:150px;"></pre>
    </section>
  </main>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const targetSystemInput = document.getElementById("targetSystem");
    const descriptionInput = document.getElementById("description");
    const knownTMPsInput = document.getElementById("knownTMPs");
    const knownTriggersInput = document.getElementById("knownTriggers");
    const submitBtn = document.getElementById("submitBtn");
    const debugConsole = document.getElementById("debugConsole");
    const goBackBtn = document.getElementById("goBackBtn");

    function logDebug(msg) {
      if(debugConsole) debugConsole.textContent += msg + "\n";
    }

    function generateCode() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    submitBtn.addEventListener("click", async () => {
      const targetSystem = targetSystemInput.value.trim();
      const description = descriptionInput.value.trim();
      const knownTMPs = knownTMPsInput.value.split(",").map(s => s.trim()).filter(Boolean);
      const knownTriggers = knownTriggersInput.value.split(",").map(s => s.trim()).filter(Boolean);

      if(!targetSystem || !description) {
        logDebug("Target System and Description are required.");
        return;
      }

      const code = generateCode();
      const preset = { code, targetSystem, description, knownTMPs, knownTriggers };

      logDebug(`Submitting preset ${code}...`);

      try {
        const res = await fetch("/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(preset)
        });
        const result = await res.json();

        if(result.success) {
          logDebug(`Preset ${result.code} saved successfully!`);
          targetSystemInput.value = "";
          descriptionInput.value = "";
          knownTMPsInput.value = "";
          knownTriggersInput.value = "";
        } else {
          logDebug(`Error: ${result.error}`);
        }
      } catch(err) {
        logDebug("Submission failed: " + err);
      }
    });

    goBackBtn.addEventListener("click", () => {
      window.location.href = "vrc-dynamic-player-tags.html";
    });

  });
  </script>

</body>
</html>
