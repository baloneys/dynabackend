<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Submit Preset - VRCDynamicPlayerTags</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- RESET & BASE -->
  <style data-tag="reset-style-sheet">
    html { line-height: 1.15; }
    body { margin: 0; }
    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    a { text-decoration: none; color: inherit; }
    input, textarea, button, select { font-family: Inter, sans-serif; }
  </style>

  <style data-tag="default-style-sheet">
    html { font-family: Inter, sans-serif; font-size: 1rem; }
    body { line-height: 1.6; background: var(--color-surface); color: var(--color-on-surface); }
  </style>

  <link rel="stylesheet" href="./style.css" />
  <link rel="stylesheet" href="./vrc-dynamic-player-tags.css" />

</head>

<body>
  <header class="header-section" style="display:flex;justify-content:space-between;align-items:center;">
    <h1 class="header-title hero-title">Create New Preset</h1>
    <button id="goBackBtn" class="btn btn-secondary btn-lg">Back</button>
  </header>

  <section style="max-width:700px;margin:2rem auto;padding:1rem;background:var(--color-surface-elevated);border-radius:8px;box-shadow:0px 4px 10px rgba(0,0,0,0.1);">
    <div class="form-group">
      <label for="targetSystem">Target System</label>
      <input id="targetSystem" type="text" placeholder="e.g. VRChat Core" class="form-control" />
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea id="description" rows="3" placeholder="Describe this preset…" class="form-control"></textarea>
    </div>

    <div class="form-group">
      <label for="knownTMPs">Known TMPs <small>(comma separated)</small></label>
      <input id="knownTMPs" type="text" placeholder="TMP1, TMP2, …" class="form-control" />
      <p style="font-size:0.85rem;color:var(--color-on-surface-secondary);">
        List all TextMeshPro object identifiers this preset modifies.
      </p>
    </div>

    <div class="form-group">
      <label for="knownTriggers">Known Triggers <small>(comma separated)</small></label>
      <input id="knownTriggers" type="text" placeholder="Trigger1, Trigger2, …" class="form-control" />
      <p style="font-size:0.85rem;color:var(--color-on-surface-secondary);">
        List all trigger names this preset uses.
      </p>
    </div>

    <button id="submitBtn" class="btn btn-primary btn-lg">Create Preset</button>

    <section style="margin-top:1rem;">
      <pre id="debugConsole" style="background:#111;color:#0f0;padding:1rem;overflow:auto;height:150px;"></pre>
    </section>
  </section>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const targetSystemInput = document.getElementById("targetSystem");
    const descriptionInput = document.getElementById("description");
    const knownTMPsInput = document.getElementById("knownTMPs");
    const knownTriggersInput = document.getElementById("knownTriggers");
    const submitBtn = document.getElementById("submitBtn");
    const debugConsole = document.getElementById("debugConsole");
    const goBackBtn = document.getElementById("goBackBtn");

    function logDebug(msg) {
      debugConsole.textContent += msg + "\n";
    }

    function generateCode() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    submitBtn.addEventListener("click", async () => {
      const targetSystem = targetSystemInput.value.trim();
      const description = descriptionInput.value.trim();
      const knownTMPs = knownTMPsInput.value.split(",").map(s => s.trim()).filter(Boolean);
      const knownTriggers = knownTriggersInput.value.split(",").map(s => s.trim()).filter(Boolean);

      if (!targetSystem || !description) {
        logDebug("Error: Target System and Description are required.");
        return;
      }

      const code = generateCode();
      const preset = { code, targetSystem, description, KnownTMPs: knownTMPs, KnownTriggers: knownTriggers };

      logDebug(`→ Submitting preset ${code}...`);
      try {
        const res = await fetch("/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(preset)
        });
        const result = await res.json();

        if (res.ok && result.success) {
          logDebug(`✔ Preset ${result.code} saved!`);
        } else {
          logDebug(`✖ Submission error: ${result.error || JSON.stringify(result)}`);
        }
      } catch (err) {
        logDebug("❌ Submission failed: " + err);
      }
    });

    goBackBtn.addEventListener("click", () => {
      window.location.href = "vrc-dynamic-player-tags.html";
    });
  });
  </script>

</body>
</html>
