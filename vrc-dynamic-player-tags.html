<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VRCDynamicPlayerTags</title>

  <!-- RESET & BASE STYLES -->
  <style data-tag="reset-style-sheet">
    html { line-height: 1.15; }
    body { margin: 0; }
    *,
    *::before,
    *::after { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    a { color: inherit; text-decoration: none; }
  </style>

  <style data-tag="default-style-sheet">
    html { font-family: Inter, sans-serif; font-size: 1rem; }
    body { line-height: 1.6; background: var(--color-surface); color: var(--color-on-surface); }
  </style>

  <!-- CORE STYLE (MUST LOAD FIRST) -->
  <link rel="stylesheet" href="./style.css" />

  <!-- PAGE STYLE -->
  <link rel="stylesheet" href="./vrc-dynamic-player-tags.css" />

  <!-- FONTS -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" />
</head>

<body>

  <!-- HEADER + NAV -->
  <header class="header-section">
    <div class="header-container">
      <div class="header-content">
        <h1 class="header-title hero-title">VRCDynamicPlayerTags</h1>
      </div>
    </div>
  </header>

  <!-- SEARCH BAR -->
  <section class="search-bar-section">
    <div class="search-bar-container">
      <div class="search-bar-card">
        <div class="search-bar-header">
          <h2 class="section-title">Explore Presets</h2>
          <p class="section-content">Search presets by Code, Target System, or Description.</p>
        </div>
        <div class="search-bar-form-wrapper">
          <div class="search-bar-input-group">
            <input type="text" id="searchInput" class="search-bar-input"
              placeholder="Exact match search..." />
          </div>
          <div class="search-bar-filter-chips">
            <button type="button" class="search-bar-chip active" data-mode="code">Code</button>
            <button type="button" class="search-bar-chip" data-mode="targetSystem">Target System</button>
            <button type="button" class="search-bar-chip" data-mode="description">Description</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- TABLE -->
  <section class="dashboard-section">
    <div class="vrcdynamicplayertags-dashboard-container">
      <div class="dashboard-table-wrapper">
        <table class="vrcdynamicplayertags-dashboard-table">
          <thead>
            <tr>
              <th>Code</th>
              <th>Target System</th>
              <th>Description</th>
              <th>KnownTMPs</th>
              <th>KnownTriggers</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ACTION BUTTONS + PAGINATION -->
  <section class="cta-actions-section">
    <div class="cta-actions-container"
      style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
      <button id="refreshBtn" class="action-card">Refresh Code List</button>
      <button id="importBtn" class="action-card">Import JSON</button>
      <button id="validateBtn" class="action-card">Validate Codes</button>
    </div>
    <div style="text-align:center; margin-top:1rem;">
      <button id="prevBtn" class="btn btn-secondary">Prev</button>
      <span id="pageInfo"></span>
      <button id="nextBtn" class="btn btn-secondary">Next</button>
    </div>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", () => {

      const PRESETS_PATH = "./presets/";
      const PAGE_SIZE = 5;

      let allPresets = [];
      let filtered = [];
      let page = 0;
      let searchMode = "code";

      const tableBody = document.getElementById("tableBody");
      const searchInput = document.getElementById("searchInput");
      const pageInfo = document.getElementById("pageInfo");
      const chips = document.querySelectorAll(".search-bar-chip");

      async function loadPresets() {
        allPresets = [];
        try {
          const indexRes = await fetch(PRESETS_PATH + "index.json");
          const files = await indexRes.json();

          for (const file of files) {
            const preset = await fetch(PRESETS_PATH + file).then(r => r.json());
            allPresets.push(preset);
          }
        } catch (err) {
          console.warn("Failed to load presets", err);
        }
        filtered = [...allPresets];
        page = 0;
        render();
      }

      function render() {
        tableBody.innerHTML = "";
        const start = page * PAGE_SIZE;
        const items = filtered.slice(start, start + PAGE_SIZE);
        items.forEach(p => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td><code>${p.code}</code></td>
            <td>${p.targetSystem}</td>
            <td>${p.description}</td>
            <td>${(p.KnownTMPs || []).join(", ")}</td>
            <td>${(p.KnownTriggers || []).join(", ")}</td>
          `;
          tableBody.appendChild(tr);
        });
        pageInfo.textContent = `Page ${page + 1} of ${Math.max(1, Math.ceil(filtered.length / PAGE_SIZE))}`;
      }

      function applySearch() {
        const q = searchInput.value.trim().toLowerCase();
        if (!q) {
          filtered = [...allPresets];
        } else {
          filtered = allPresets.filter(p => {
            const value = (p[searchMode] || "").toLowerCase();
            return value === q;
          });
        }
        page = 0;
        render();
      }

      searchInput.addEventListener("input", applySearch);

      chips.forEach(c => {
        c.addEventListener("click", () => {
          chips.forEach(b => b.classList.remove("active"));
          c.classList.add("active");
          searchMode = c.dataset.mode;
          applySearch();
        });
      });

      document.getElementById("prevBtn").addEventListener("click", () => {
        if (page > 0) {
          page--;
          render();
        }
      });

      document.getElementById("nextBtn").addEventListener("click", () => {
        if ((page + 1) * PAGE_SIZE < filtered.length) {
          page++;
          render();
        }
      });

      document.getElementById("refreshBtn").addEventListener("click", loadPresets);
      document.getElementById("importBtn").addEventListener("click", () => {});
      document.getElementById("validateBtn").addEventListener("click", () => {});

      loadPresets();
    });
  </script>

</body>
</html>
