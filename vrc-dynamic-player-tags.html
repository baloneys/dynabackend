<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VRC Dynamic Player Tags</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>

<section class="search-bar-section">
  <div class="search-bar-container">
    <div class="search-bar-card">
      <div class="search-bar-header">
        <h2 class="section-title">Explore Presets</h2>
        <p class="section-content">
          Search presets by code, target system, or description.
        </p>
      </div>

      <div class="search-bar-form-wrapper">
        <div class="search-bar-input-group">
          <input
            id="searchInput"
            class="search-bar-input"
            placeholder="Exact match only"
          />
        </div>

        <div class="search-bar-filter-chips">
          <button class="search-bar-chip active" data-mode="code">Code</button>
          <button class="search-bar-chip" data-mode="target">Target</button>
          <button class="search-bar-chip" data-mode="description">Description</button>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="content-section">
  <table>
    <thead>
      <tr>
        <th>Code</th>
        <th>Target System</th>
        <th>Description</th>
        <th>KnownTMPs</th>
        <th>KnownTriggers</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="bottom-controls">
    <button id="refreshBtn">Refresh Code List</button>
    <button id="importBtn">Import JSON</button>
    <button id="validateBtn">Validate Codes</button>
  </div>

  <div class="pagination">
    <button id="prevPage">Prev</button>
    <span id="pageInfo"></span>
    <button id="nextPage">Next</button>
  </div>
</section>

<script>
const PAGE_SIZE = 5;
const PRESET_PATH = "./presets/";

let presets = [];
let filtered = [];
let page = 1;
let searchMode = "code";

async function loadPresets() {
  const index = await fetch(PRESET_PATH + "index.json").then(r => r.json());
  presets = [];

  for (const file of index) {
    const data = await fetch(PRESET_PATH + file).then(r => r.json());
    presets.push(data);
  }

  filtered = presets;
  page = 1;
  render();
}

function render() {
  const body = document.getElementById("tableBody");
  body.innerHTML = "";

  const start = (page - 1) * PAGE_SIZE;
  const slice = filtered.slice(start, start + PAGE_SIZE);

  for (const p of slice) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.code}</td>
      <td>${p.targetSystem}</td>
      <td>${p.description}</td>
      <td>${p.KnownTMPs.join(", ")}</td>
      <td>${p.KnownTriggers.join(", ")}</td>
    `;
    body.appendChild(tr);
  }

  document.getElementById("pageInfo").textContent =
    `Page ${page} / ${Math.max(1, Math.ceil(filtered.length / PAGE_SIZE))}`;
}

function applySearch(value) {
  if (!value) {
    filtered = presets;
  } else {
    filtered = presets.filter(p => {
      if (searchMode === "code") return p.code === value;
      if (searchMode === "target") return p.targetSystem === value;
      if (searchMode === "description") return p.description === value;
    });
  }
  page = 1;
  render();
}

document.getElementById("searchInput").addEventListener("input", e => {
  applySearch(e.target.value.trim());
});

document.querySelectorAll(".search-bar-chip").forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll(".search-bar-chip").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    searchMode = btn.dataset.mode;
    applySearch(document.getElementById("searchInput").value.trim());
  };
});

document.getElementById("prevPage").onclick = () => {
  if (page > 1) page--, render();
};

document.getElementById("nextPage").onclick = () => {
  if (page * PAGE_SIZE < filtered.length) page++, render();
};

document.getElementById("refreshBtn").onclick = loadPresets;
document.getElementById("importBtn").onclick = () => {};
document.getElementById("validateBtn").onclick = () => {};

loadPresets();
</script>

</body>
</html>
